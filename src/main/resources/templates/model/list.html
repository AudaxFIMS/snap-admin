<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
	<head th:replace="~{fragments/resources::head}">
	</head>
	<body>
		<!-- Modal -->
		<div class="modal fade" id="csvExportModal" tabindex="-1" aria-labelledby="csvExportModalLabel" aria-hidden="true">
			<form th:action="|/${dbadmin_baseUrl}/export/${schema.getClassName()}|" method="GET">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="csvExportModalLabel">Export settings</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="container-fluid">
								<h5 class="fw-bold">Include columns</h5>
								<div th:each="field : ${schema.getSortedFields()}" th:if="${field.isExportable()}">
									<div class="form-check">
										<input class="form-check-input" type="checkbox" 
											th:value="${field.getName()}" th:id="|__check_${field.getName()}|"
											th:name="fields[]" 
											checked>
										<label class="form-check-label" th:for="|__check_${field.getName()}|">
									    	[[ ${field.getName()} ]]
										</label>
									</div>
								</div>
								<h5 class="fw-bold mt-3" th:if="${!activeFilters.isEmpty()}">Active filters</h5>
								<div th:each="filter : ${activeFilters}">
									<span class="active-filter badge bg-primary me-1 mb-2 p-2 font-monospace noselect">
										[[ ${filter}]]
									</span>
								</div>
								<h5 class="fw-bold mt-3">Export format</h3>
								<select name="format" class="form-select">
									<option value="csv">CSV</option>
									<option value="xlsx">XLSX</option>
								</select>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="submit" class="btn btn-primary">Save changes</button>
						</div>
					</div>
				</div>
			</form>
		</div>
		<!-- End modal -->
		

		<div class="bg-light main-wrapper">
			<nav th:replace="~{fragments/resources :: navbar}"></nav>
		    <div class="d-flex">
		    	<div th:replace="~{fragments/resources :: sidebar('entities')}"></div>
		    	<div class="main-content bg-lighter">
		    		<th:block th:replace="~{fragments/resources :: alerts}"></th:block>
					<h1 class="fw-bold mb-4"><i class="align-middle bi bi-database"></i>
						<span class="align-middle"><a th:href="|/${dbadmin_baseUrl}|">Entities</a></span> 
						<i class="align-middle bi bi-chevron-double-right"></i> 
						<span class="align-middle"> [[ ${schema.getJavaClass().getSimpleName()} ]] </span>
					</h1>
		    		<div class="row mt-4">
		    			<div th:class="${schema.getFilterableFields().isEmpty() ? 'col' : 'col-9'}">
	    					<div class="w-100 d-flex inner-navigation">
	    						<a th:href="|/${dbadmin_baseUrl}/model/${className}|" class="active">
		    						<div class="ui-tab ps-5 pe-5 p-3">
		    							<i class="bi bi-database pe-2"></i> DATA
		    						</div>
		    					</a>
		    					<a th:href="|/${dbadmin_baseUrl}/model/${className}/schema|">
		    						<div class="ui-tab ps-5 pe-5 p-3">
		    							<i class="bi bi-table pe-2"></i> SCHEMA
		    						</div>
		    					</a>
		    					<div class="inner-navigation-border flex-grow-1">
		    					</div>
	    					</div>
							<div class="box with-navigation">
								<form th:action="|/${dbadmin_baseUrl}/model/${className}|" method="GET" class="mb-3">
			    					<div class="input-group">
			    						<span class="input-group-text"><i class="bi bi-search"></i></span>
			    						<input type="text" th:value="${query}"
			    						placeholder="Type and press ENTER to search" 
			    						class="ui-text-input form-control" name="query" autofocus>
			    						<button class="ui-btn btn btn-primary">Search</button>
			    					</div>
			    					<th:block th:each="queryParam : ${dbadmin_queryParams.keySet()}">
										<input th:each="paramValue : ${dbadmin_queryParams.get(queryParam)}"
											th:if="${queryParam.startsWith('filter_')}" 
											th:name="${queryParam}" th:value="${paramValue}" type="hidden">
									</th:block>
									
									<input type="hidden" name="page" value="1">
									<input type="hidden" name="pageSize" 
										th:value="${page != null ? page.getPagination().getPageSize() : '50'}">
			    				</form>
								<div class="separator mb-4 mt-4"></div>
							
		    					<div class="d-flex justify-content-between">
		    					
		    					
									<h3 class="fw-bold mb-4 align-baseline flex-grow-1">
										<span title="Java class name"> [[ ${schema.getJavaClass().getSimpleName()} ]] </span>
										<span title="Database table name" class="ms-3 label label-primary label-gray font-monospace">
											[[ ${schema.getTableName()} ]]
										</span>
										<button type="button" class="btn p-0 m-0 ms-3"  data-bs-toggle="modal" data-bs-target="#csvExportModal">
											<i class="bi bi-filetype-csv" style="font-size: 1.5rem;"></i>
										</button>
									</h3>
									
									<h3 class="create-button">
										<a th:title="|${!schema.isCreateEnabled() ? 'CREATE disabled for this type' : 'Create new item'}|" 
											th:class="|${!schema.isCreateEnabled() ? 'disable' : ''}|"
											th:href="|/${dbadmin_baseUrl}/model/${schema.getClassName()}/create|"><i class="bi bi-plus-square"></i></a>
									</h3>
								</div>
								
								<th:block th:if="${page}">
									<div th:replace="~{fragments/table_selectable :: table(results=${page.getResults()}, schema=${schema})}">
									</div>
								</th:block>
							</div>
		    			</div>
		    			<div th:if="${!schema.getFilterableFields().isEmpty()}" class="col-3">
							<div class="box filterable-fields">
								<h3 class="fw-bold mb-3"><i class="bi bi-funnel"></i> Filters</h3>
								
								<div class="mb-2">
									<div th:each="filter : ${activeFilters}">
									
										<span title="Click to remove this filter" 
											class="active-filter badge bg-primary me-1 mb-2 p-2 font-monospace cursor-pointer noselect"
											th:data-formid="${filter.toString()}"
											>
											[[ ${filter}]] <i class="bi bi-x-circle"></i>
										</span>
										<form action="" th:id="${filter.toString()}" method="GET">
											<th:block th:each="p : ${dbadmin_queryParams.keySet()}">
												<input th:each="v : ${dbadmin_queryParams.get(p)}" th:name="${p}" th:value="${v}" type="hidden">
											</th:block>
											<input type="hidden" name="remove_field" th:value="${filter.getField().getJavaName()}">
											<input type="hidden" name="remove_op" th:value="${filter.getOp()}">
											<input type="hidden" name="remove_value" th:value="${filter.getValue()}">
										</form>
									</div>
										
										
										
										
										
										
										
								</div>
								
								<th:block th:each="field : ${schema.getFilterableFields()}">
									<div th:replace="~{fragments/forms :: filter_field(field=${field})}"></div>
								</th:block>
								
							</div>
						</div>
		    		</div>
		    	</div>
		    </div>
		</div>
		
	</body>
</html>